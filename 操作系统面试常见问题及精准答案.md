# 操作系统面试常见问题及精准答案

## 一、进程与线程

### 1. 什么是进程？什么是线程？

| 概念 | 定义 |
|------|------|
| **进程** | 程序关于某数据集合的一次运行活动，是操作系统进行**资源分配**的基本单位 |
| **线程** | 进程内的执行单元，是**CPU调度和分派**的基本单位，多个线程共享进程资源 |

### 2. 进程和线程的区别

| 区别点 | 进程 | 线程 |
|--------|------|------|
| 资源拥有 | 拥有独立资源（内存空间等） | 共享同一进程资源 |
| 通信方式 | 需IPC机制（管道、消息队列等） | 直接读写共享内存，效率高 |
| 创建/销毁 | 开销大，速度慢 | 开销小，速度快 |
| 调度单位 | 资源分配的基本单位 | CPU调度的基本单位 |
| 独立性 | 相互独立，崩溃不影响其他进程 | 同进程线程间相互影响 |
| 切换开销 | 大（需切换地址空间） | 小（共享地址空间） |

### 3. 进程的状态及转换

**五状态模型**：新建 → 就绪 → 运行 → 阻塞 → 终止

```
        时间片到/被抢占
            ↙ ↖
   就绪 ←←← 运行 →→→ 终止
    ↑        ↓
    ←←←←← 阻塞
     I/O完成   等待I/O
```

| 转换 | 触发条件 |
|------|----------|
| 就绪 → 运行 | 被CPU调度选中 |
| 运行 → 就绪 | 时间片用尽或被高优先级抢占 |
| 运行 → 阻塞 | 等待I/O或资源 |
| 阻塞 → 就绪 | I/O完成或资源就绪 |

### 4. 进程间通信（IPC）方式

| 方式 | 特点 | 适用场景 |
|------|------|----------|
| **管道（Pipe）** | 单向，半双工 | 父子进程通信 |
| **命名管道（FIFO）** | 可用于无亲缘关系进程 | 独立进程间通信 |
| **消息队列** | 消息链表，按类型读写 | 异步通信 |
| **共享内存** | 最快的IPC方式 | 大数据量高频通信 |
| **信号量（Semaphore）** | 用于同步和互斥 | 资源访问控制 |
| **信号（Signal）** | 异步通知机制 | 事件通知 |
| **套接字（Socket）** | 可跨主机通信 | 网络通信 |

---

## 二、进程/线程同步与死锁

### 1. 为什么需要同步？

防止多线程/进程竞争资源导致的**数据不一致**或**竞态条件（Race Condition）**。

### 2. 常见同步机制

| 机制 | 说明 |
|------|------|
| **互斥锁（Mutex）** | 保证同一时刻只有一个线程访问临界区 |
| **信号量（Semaphore）** | 控制多个线程对共享资源的访问数量 |
| **条件变量** | 线程等待某个条件成立后再继续执行 |
| **读写锁** | 允许多读单写，提高并发性能 |
| **自旋锁** | 忙等待，适用于锁持有时间短的场景 |

### 3. 什么是死锁？

**定义**：多个进程因争夺资源而互相等待，导致都无法继续执行的状态。

**死锁产生的四个必要条件**：

| 条件 | 说明 |
|------|------|
| **互斥** | 资源同一时刻只能被一个进程占用 |
| **占有并等待** | 进程已占有资源，又请求其他资源 |
| **不可抢占** | 资源只能由持有者主动释放 |
| **循环等待** | 进程间形成资源等待环 |

### 4. 死锁的处理策略

| 策略 | 说明 |
|------|------|
| **预防** | 破坏���个必要条件之一（如一次性申请所有资源） |
| **避免** | 动态检测（如银行家算法），拒绝不安全的资源请求 |
| **检测与恢复** | 允许死锁发生，检测到后通过终止进程或剥夺资源解除 |
| **鸵鸟策略** | 忽略死锁，适用于死锁极少发生的场景 |

### 5. 银行家算法核心思想

- 在分配资源前，判断系统是否处于**安全状态**
- 若分配后仍有**安全序列**（所有进程能顺利完成），则分配；否则拒绝

---

## 三、内存管理

### 1. 内存管理的主要功能

- 内存分配与回收
- 地址转换（逻辑地址 → 物理地址）
- 内存保护与共享
- 虚拟内存管理

### 2. 分页与分段的区别

| 区别点 | 分页 | 分段 |
|--------|------|------|
| 单位大小 | 固定（如4KB） | 不固定，按逻辑划分 |
| 用户可见 | 不可见（系统管理） | 可见（程序员可操作） |
| 碎片类型 | 内部碎片 | 外部碎片 |
| 地址结构 | 页号 + 页内偏移 | 段号 + 段内偏移 |
| 目的 | 提高内存利用率 | 便于模块化和共享 |

### 3. 什么是虚拟内存？

**定义**：利用磁盘空间作为扩展内存，为程序提供一个连续、完整的地址空间视图。

**优点**：
- ✅ 程序无需完全装入内存即可运行
- ✅ 支持比物理内存更大的地址空间
- ✅ 提高多任务并发度
- ✅ 便于内存保护与共享
- ✅ 实现按需加载（Demand Paging）

### 4. 页面置换算法

| 算法 | 原理 | 优缺点 |
|------|------|--------|
| **FIFO** | 先进先出 | 简单，但可能Belady异常 |
| **LRU** | 最近最久未使用 | 效果好，实现复杂 |
| **Clock** | 近似LRU，使用访问位 | 折中方案，性能较好 |
| **OPT** | 置换未来最久不用的页 | 理论最优，无法实现 |

### 5. 重要概念

| 概念 | 说明 |
|------|------|
| **TLB（快表）** | 页表高速缓存，加速虚拟地址到物理地址转换 |
| **多级页表** | 减少页表内存占用，只为实际使用的地址分配页表 |
| **缺页中断** | 访问的页不在内存时触发，需从磁盘加载 |

### 6. 缺页中断处理流程

```
1. 产生缺页异常
2. 查找页面在磁盘上的位置
3. 若内存已满，选择页面置换（根据置换算法）
4. 将所需页面加载到内存
5. 更新页表
6. 恢复进程继续执行
```

---

## 四、其他高频问题

### 1. 用户态与内核态

| 区别 | 用户态 | 内核态 |
|------|--------|--------|
| 权限 | 低，只能访问有限资源 | 高，可访问所有硬件和内存 |
| 切换场景 | — | 系统调用、异常、中断 |
| 安全性 | 受限，保护系统稳定 | 需谨慎操作 |

### 2. 什么是上下文切换？

保存当前进程/线程的CPU状态（寄存器、程序计数器等），加载另一进程/线程状态，使CPU切换执行。

**开销来源**：
- 保存/恢复寄存器
- 刷新TLB和缓存
- 调度算法执行

### 3. 什么是中断？

CPU暂停当前任务，响应外部/内部事件（如I/O完成、时钟中断），处理完毕后返回继续执行。

| 类型 | 说明 |
|------|------|
| **硬中断** | 由外部硬件触发（如键盘、网卡） |
| **软中断** | 由程序指令触发（如系统调用） |

### 4. 进程调度算法

| 算法 | 特点 |
|------|------|
| **FCFS（先来先服务）** | 简单，但可能导致短作业等待过久 |
| **SJF（短作业优先）** | 平均等待时间最短，但可能饿死长作业 |
| **RR（时间片轮转）** | 公平，适合交互式系统 |
| **优先级调度** | 按优先级执行，可能饿死低优先级进程 |
| **多级反馈队列** | 综合多种算法优点，灵活高效 |

---

## 五、常考代码题

### 1. 生产者-消费者问题（伪代码）

```c
semaphore mutex = 1;    // 互斥锁
semaphore empty = N;    // 空槽位数量
semaphore full = 0;     // 满槽位数量

// 生产者
void producer() {
    while (true) {
        produce_item();
        P(empty);       // 等待空槽位
        P(mutex);       // 进入临界区
        insert_item();
        V(mutex);       // 离开临界区
        V(full);        // 增加满槽位
    }
}

// 消费者
void consumer() {
    while (true) {
        P(full);        // 等待满槽位
        P(mutex);       // 进入临界区
        remove_item();
        V(mutex);       // 离开临界区
        V(empty);       // 增加空槽位
        consume_item();
    }
}
```

### 2. 读者-写者问题要点

- 多个读者可同时读
- 写者独占访问
- 需防止读者或写者饥饿